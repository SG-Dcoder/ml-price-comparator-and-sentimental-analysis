<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results - {{ data.query|default('Search') }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <div class="row mt-4 mb-4">
            <div class="col-12">
                <a href="/" class="btn btn-outline-primary mb-3">
                    New Search
                </a>
                <h2>Results for: {{ data.query|default('Your search') }}</h2>
            </div>
        </div>
        
        <!-- Best Deal Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow border-success">
                    <div class="card-header bg-success text-white">
                        <h3 class="mb-0">Best Deal Found</h3>
                    </div>
                    <div class="card-body">
                        {% if data.best_deal and data.best_deal.product %}
                            <h4>{{ data.best_deal.product.name|default('Product') }}</h4>
                            <p class="fs-2 fw-bold text-success">₹{{ data.best_deal.price|default('N/A') }}</p>
                            <p class="mb-1">Platform: {{ data.best_deal.platform|default('Unknown')|title }}</p>
                            {% if data.best_deal.product.rating %}
                                <p class="mb-1">Rating: {{ data.best_deal.product.rating }} ⭐</p>
                            {% endif %}
                            {% if data.best_deal.product.url %}
                                <a href="{{ data.best_deal.product.url }}" target="_blank" class="btn btn-primary mt-2">
                                    View on {{ data.best_deal.platform|default('Platform')|title }}
                                </a>
                            {% endif %}
                        {% else %}
                            <p>No products found matching your query.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Price Forecast Section -->
        {% if data.price_forecast %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-info text-white">
                        <h3 class="mb-0">Price Forecast</h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <strong>Best time to buy:</strong> {{ data.price_forecast.best_time.best_date|default('N/A') }} 
                            (Predicted price: ₹{{ data.price_forecast.best_time.predicted_price|default('N/A') }})
                        </div>
                        
                        <div class="text-center mt-3">
                            {% if data.price_forecast.forecast_plot %}
                                <img src="data:image/png;base64,{{ data.price_forecast.forecast_plot }}" 
                                     alt="Price Forecast" class="img-fluid">
                            {% else %}
                                <p>No forecast plot available</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Platform Reliability Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-warning text-white">
                        <h3 class="mb-0">Platform Reliability Analysis</h3>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <strong>Most Reliable Platform:</strong> 
                            {{ data.platform_reliability.most_reliable_platform|default('N/A')|title }}
                            (Reliability Score: {{ data.platform_reliability.reliability_score|default('0') }}/100)
                        </div>
                        
                        <div class="row">
                            {% if data.platform_reliability and data.platform_reliability.platform_scores %}
                                {% for platform, scores in data.platform_reliability.platform_scores.items() %}
                                <div class="col-md-6 mb-3">
                                    <div class="card">
                                        <div class="card-header">
                                            {{ platform|title }}
                                        </div>
                                        <div class="card-body">
                                            <p>Reliability Score: {{ scores.reliability_score|default('0') }}/100</p>
                                            <p>Reviews Analyzed: {{ scores.total_reviews|default('0') }}</p>
                                            
                                            {% if scores.total_reviews|default(0) > 0 %}
                                                <div class="progress mb-2">
                                                    <div class="progress-bar bg-success" role="progressbar" 
                                                         style="width: {{ scores.positive_width|default(0) }}%">
                                                        Positive ({{ scores.positive|default('0') }})
                                                    </div>
                                                </div>
                                                <div class="progress mb-2">
                                                    <div class="progress-bar bg-warning" role="progressbar" 
                                                         style="width: {{ scores.neutral_width|default(0) }}%">
                                                        Neutral ({{ scores.neutral|default('0') }})
                                                    </div>
                                                </div>
                                                <div class="progress mb-2">
                                                    <div class="progress-bar bg-danger" role="progressbar" 
                                                         style="width: {{ scores.negative_width|default(0) }}%">
                                                        Negative ({{ scores.negative|default('0') }})
                                                    </div>
                                                </div>
                                            {% else %}
                                                <p>No review data available</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            {% else %}
                                <div class="col-12">
                                    <p>No platform reliability data available.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- All Products Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-secondary text-white">
                        <h3 class="mb-0">All Products Found</h3>
                    </div>
                    <div class="card-body">
                        {% if data.products and data.products.items()|list|length > 0 %}
                            <ul class="nav nav-tabs" id="platformTabs" role="tablist">
                                {% for platform, products in data.products.items() %}
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link {% if loop.first %}active{% endif %}" 
                                            id="{{ platform }}-tab" data-bs-toggle="tab" 
                                            data-bs-target="#{{ platform }}" type="button" role="tab">
                                        {{ platform|title }} ({{ products|length }})
                                    </button>
                                </li>
                                {% endfor %}
                            </ul>
                            
                            <div class="tab-content mt-3" id="platformTabsContent">
                                {% for platform, products in data.products.items() %}
                                <div class="tab-pane fade {% if loop.first %}show active{% endif %}" 
                                     id="{{ platform }}" role="tabpanel">
                                    {% if products %}
                                        <div class="list-group">
                                            {% for product in products %}
                                            <a href="{{ product.url|default('#') }}" target="_blank" 
                                               class="list-group-item list-group-item-action">
                                                <div class="d-flex w-100 justify-content-between">
                                                    <h5 class="mb-1">{{ product.name|default('Product') }}</h5>
                                                    <strong class="text-success">₹{{ product.price|default('N/A') }}</strong>
                                                </div>
                                                {% if product.rating %}
                                                    <p class="mb-1">Rating: {{ product.rating }} ⭐</p>
                                                {% endif %}
                                            </a>
                                            {% endfor %}
                                        </div>
                                    {% else %}
                                        <p>No products found on {{ platform|title }}.</p>
                                    {% endif %}
                                </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p>No products found.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>